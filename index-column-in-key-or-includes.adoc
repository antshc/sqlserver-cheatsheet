= SQL Server Index: Key vs INCLUDE

== ğŸŒ± Quick Summary

|===
| Feature                    | Key Columns                              | INCLUDE Columns                         

| Participate in ordering?   | âœ… Yes (sorted in B-Tree)               | âŒ No (not sorted, stored at leaf level)  
| Affects index uniqueness?  | âœ… Yes (part of uniqueness)             | âŒ No                                    
| Used for filtering/search? | âœ… Yes (seek and scan predicates)        | âŒ No                                    
| Returned by query?         | âœ… Yes (if in key)                      | âœ… Yes (at leaf level, covers query)     
| Storage cost?              | ğŸŸ¥ Higher (stored in every B-Tree level) | ğŸŸ© Lower (only in leaf level)            
| Can be used in WHERE?      | âœ… Yes                                   | âŒ No                                    
| Can be used in JOIN/ORDER BY?| âœ… Yes                                 | âŒ No                                    
|===

== âœ… Put Columns in **KEY** When
* They are used in `WHERE`, `JOIN`, or `ON` clauses (seek/filter).
* They are used in `ORDER BY` (because keys define the sort order).
* They are needed to make the index **unique** (if it's a unique index).
* They are part of `GROUP BY` or `DISTINCT` operations.

.Example
[source,sql]
----
-- Query
SELECT Name, Email FROM Customers
WHERE Country = 'USA' AND State = 'CA'
ORDER BY SignupDate DESC
----

ğŸ“Œ Index: `(Country, State, SignupDate)`  
- `Country`, `State` = **Key** (used for filtering)
- `SignupDate` = **Key** (for ordering)

== â• Put Columns in **INCLUDE** When
* They are **only needed to cover the SELECT** list (not filtered/sorted).
* They are **large** (e.g., `nvarchar(MAX)`, `varchar(1000)`) and donâ€™t need to be in B-Tree levels.
* You want to avoid **key size limits** (900 bytes or 16 columns max in key).
* They are **frequently read but not searched on**.

.Example
[source,sql]
----
-- Query
SELECT Name, Email FROM Customers
WHERE Country = 'USA'
----

ğŸ“Œ Index: `(Country) INCLUDE (Name, Email)`  
- `Country` = **Key** (filtering)  
- `Name`, `Email` = **INCLUDE** (to avoid key lookups)

== âš ï¸ Why Care?
* **Key columns** are stored in every level of the B-Tree (root, intermediate, leaf).
* **INCLUDE columns** are stored **only at the leaf level**, so they use less space and reduce index maintenance overhead.

== ğŸ“ Rule of Thumb

|===
| Question                                        | Put in Key? | Put in INCLUDE?

| Used in WHERE/JOIN predicates?                  | âœ… Yes      | âŒ No
| Needed for sorting (ORDER BY)?                  | âœ… Yes      | âŒ No
| Needed only to satisfy SELECT list?             | âŒ No       | âœ… Yes
| Large column (e.g., nvarchar(MAX), XML)?         | âŒ No       | âœ… Yes
| Needed to enforce uniqueness?                   | âœ… Yes      | âŒ No
|===

== ğŸš€ Final Tip
If you see **Key Lookup** in execution plans, itâ€™s a sign the index is missing some **INCLUDE** columns.
